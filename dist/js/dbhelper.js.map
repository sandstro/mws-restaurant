{"version":3,"sources":["dbhelper.js"],"names":["DBHelper","callback","fetch","DATABASE_URL","then","response","ok","json","Error","restaurants","catch","error","err","message","id","fetchRestaurants","restaurant","find","r","cuisine","results","filter","cuisine_type","neighborhood","neighborhoods","map","v","i","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","photograph","marker","google","maps","Marker","position","latlng","title","name","url","urlForRestaurant","animation","Animation","DROP","port"],"mappings":"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","file":"dbhelper.js","sourcesContent":["/**\r\n * Common database helper functions.\r\n */\r\nclass DBHelper {\r\n\r\n  /**\r\n   * Database URL.\r\n   */\r\n  static get DATABASE_URL() {\r\n    const port = 1337\r\n    return `http://localhost:${port}/restaurants`;\r\n  }\r\n\r\n  /**\r\n   * Fetch all restaurants.\r\n   */\r\n  static fetchRestaurants(callback) {\r\n    fetch(DBHelper.DATABASE_URL).then(response => {\r\n      if (response.ok) {\r\n        return response.json();\r\n      }\r\n      throw new Error('Network response was not ok.');\r\n    }).then(json => {\r\n      const restaurants = json;\r\n      callback(null, restaurants);\r\n    }).catch(err => {\r\n      const error = (`Request failed. Returned status of ${err.message}`);\r\n      callback(error, null);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch a restaurant by its ID.\r\n   */\r\n  static fetchRestaurantById(id, callback) {\r\n    // fetch all restaurants with proper error handling.\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const restaurant = restaurants.find(r => r.id == id);\r\n        if (restaurant) { // Got the restaurant\r\n          callback(null, restaurant);\r\n        } else { // Restaurant does not exist in the database\r\n          callback('Restaurant does not exist', null);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine type with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisine(cuisine, callback) {\r\n    // Fetch all restaurants  with proper error handling\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given cuisine type\r\n        const results = restaurants.filter(r => r.cuisine_type == cuisine);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given neighborhood\r\n        const results = restaurants.filter(r => r.neighborhood == neighborhood);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let results = restaurants\r\n        if (cuisine != 'all') { // filter by cuisine\r\n          results = results.filter(r => r.cuisine_type == cuisine);\r\n        }\r\n        if (neighborhood != 'all') { // filter by neighborhood\r\n          results = results.filter(r => r.neighborhood == neighborhood);\r\n        }\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all neighborhoods with proper error handling.\r\n   */\r\n  static fetchNeighborhoods(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all neighborhoods from all restaurants\r\n        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood)\r\n        // Remove duplicates from neighborhoods\r\n        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i)\r\n        callback(null, uniqueNeighborhoods);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all cuisines with proper error handling.\r\n   */\r\n  static fetchCuisines(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all cuisines from all restaurants\r\n        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type)\r\n        // Remove duplicates from cuisines\r\n        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i)\r\n        callback(null, uniqueCuisines);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Restaurant page URL.\r\n   */\r\n  static urlForRestaurant(restaurant) {\r\n    return (`./restaurant.html?id=${restaurant.id}`);\r\n  }\r\n\r\n  /**\r\n   * Restaurant image URL.\r\n   */\r\n  static imageUrlForRestaurant(restaurant) {\r\n    return (`/img/${restaurant.photograph}`);\r\n  }\r\n\r\n  /**\r\n   * Map marker for a restaurant.\r\n   */\r\n  static mapMarkerForRestaurant(restaurant, map) {\r\n    const marker = new google.maps.Marker({\r\n      position: restaurant.latlng,\r\n      title: restaurant.name,\r\n      url: DBHelper.urlForRestaurant(restaurant),\r\n      map: map,\r\n      animation: google.maps.Animation.DROP}\r\n    );\r\n    return marker;\r\n  }\r\n\r\n}\r\n"]}